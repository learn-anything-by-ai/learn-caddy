# 基础反向代理配置
# 将 API 请求代理到后端服务器

localhost:8080 {
    # 静态文件服务（主页面）
    root * static
    
    # 处理 API 请求 - 代理到后端服务器
    reverse_proxy /api/* {
        # 后端服务器地址
        to localhost:3001
        
        # 添加自定义请求头
        header_up X-Forwarded-Proto {scheme}
        header_up X-Real-IP {remote_host}
        
        # 健康检查
        health_uri /health
        health_interval 30s
        health_timeout 5s
    }
    
    # 为其他路径提供静态文件
    file_server
    
    # 日志记录
    log {
        output file proxy.log
        format json
    }
    
    # 错误处理
    handle_errors {
        @502 {
            expression {http.error.status_code} == 502
        }
        rewrite @502 /error.html
        file_server
    }
}
