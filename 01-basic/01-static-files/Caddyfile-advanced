# 更高级的 Caddy 配置示例
# 这个配置文件展示了更多的静态文件服务选项

localhost:8080 {
    # 设置网站根目录
    root * www
    
    # 文件服务器配置
    file_server {
        # 启用目录浏览
        browse
        
        # 隐藏特定文件和目录
        hide .env .git *.tmp
        
        # 设置默认索引文件
        index index.html index.htm
    }
    
    # 压缩配置 - 提高传输效率
    encode {
        gzip 5
        zstd
    }
    
    # 缓存控制 - 提高性能
    header {
        # 对静态资源设置缓存
        Cache-Control "public, max-age=3600" "*.css" "*.js" "*.png" "*.jpg" "*.gif"
        
        # 对 HTML 文件设置较短缓存
        Cache-Control "public, max-age=300" "*.html"
        
        # 安全头
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # 自定义服务器标识
        Server "Caddy/Learning-Example"
    }
    
    # 日志配置
    log {
        output file access.log
        format single_field common_log
    }
    
    # 错误页面
    handle_errors {
        @404 {
            expression {http.error.status_code} == 404
        }
        rewrite @404 /404.html
        file_server
    }
    
    # 特殊路径处理
    handle /api/* {
        respond "API endpoint not implemented" 501
    }
    
    # 重定向示例
    redir /old-page /about.html permanent
}
